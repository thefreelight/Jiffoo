# Jiffoo ç»Ÿä¸€æ’ä»¶ç³»ç»Ÿ

ğŸ‰ **é‡æ„å®Œæˆï¼** æ’ä»¶ç³»ç»Ÿç›®å½•ç»“æ„å·²æˆåŠŸé‡æ„ï¼Œç°åœ¨æ‹¥æœ‰æ¸…æ™°ã€ç»Ÿä¸€çš„æ¶æ„ã€‚

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
plugins/                           # ç»Ÿä¸€æ’ä»¶æ ¹ç›®å½•
â”œâ”€â”€ core/                          # ğŸ”§ æ ¸å¿ƒæ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ types/                     # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts              # ç»Ÿä¸€ç±»å‹å¯¼å‡º
â”‚   â”œâ”€â”€ managers/                  # ç®¡ç†å™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ unified-manager.ts    # âœ… ç»Ÿä¸€æ’ä»¶ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ hot-swap.ts           # âœ… ä¼ªçƒ­æ’æ‹”ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ installer.ts          # âœ… ä¸€é”®å®‰è£…å™¨
â”‚   â”‚   â””â”€â”€ route-manager.ts      # âœ… è·¯ç”±ç®¡ç†å™¨
â”‚   â”œâ”€â”€ services/                  # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ license.ts            # âœ… è®¸å¯è¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ validator.ts          # âœ… éªŒè¯æœåŠ¡
â”‚   â””â”€â”€ index.ts                  # âœ… ç»Ÿä¸€å…¥å£æ–‡ä»¶
â”œâ”€â”€ official/                      # ğŸ†“ å®˜æ–¹å…è´¹æ’ä»¶
â”‚   â”œâ”€â”€ payment/                   # æ”¯ä»˜æ’ä»¶
â”‚   â”‚   â””â”€â”€ alipay/               # âœ… æ”¯ä»˜å®æ’ä»¶ç¤ºä¾‹
â”‚   â”œâ”€â”€ auth/                      # è®¤è¯æ’ä»¶
â”‚   â”œâ”€â”€ notification/              # é€šçŸ¥æ’ä»¶
â”‚   â””â”€â”€ analytics/                 # åˆ†ææ’ä»¶
â”œâ”€â”€ community/                     # ğŸ‘¥ ç¤¾åŒºæ’ä»¶
â”‚   â””â”€â”€ examples/                 # ç¤ºä¾‹æ’ä»¶
â”œâ”€â”€ commercial/                    # ğŸ’° å•†ä¸šæ’ä»¶
â”‚   â””â”€â”€ payment/                  # âœ… å·²è¿ç§»å•†ä¸šæ”¯ä»˜æ’ä»¶
â”œâ”€â”€ templates/                     # ğŸ“‹ æ’ä»¶æ¨¡æ¿
â”‚   â””â”€â”€ basic/                    # âœ… åŸºç¡€æ’ä»¶æ¨¡æ¿
â”œâ”€â”€ tools/                         # ğŸ› ï¸ å¼€å‘å·¥å…·
â”‚   â””â”€â”€ cli/                      # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ docs/                          # ğŸ“š æ’ä»¶æ–‡æ¡£
â”‚   â””â”€â”€ getting-started.md        # âœ… å¿«é€Ÿå…¥é—¨æŒ‡å—
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸ¯ é‡æ„æˆæœ

### âœ… å·²å®Œæˆ

1. **ç›®å½•ç»“æ„é‡æ„**
   - åˆ›å»ºäº†æ¸…æ™°çš„ç›®å½•å±‚æ¬¡ç»“æ„
   - æŒ‰åŠŸèƒ½å’Œç±»å‹ç»„ç»‡æ’ä»¶æ–‡ä»¶
   - ç»Ÿä¸€äº†æ’ä»¶å­˜æ”¾ä½ç½®

2. **æ ¸å¿ƒæ–‡ä»¶è¿ç§»**
   - ç»Ÿä¸€æ’ä»¶ç®¡ç†å™¨ â†’ `plugins/core/managers/unified-manager.ts`
   - ä¼ªçƒ­æ’æ‹”ç®¡ç†å™¨ â†’ `plugins/core/managers/hot-swap.ts`
   - ä¸€é”®å®‰è£…å™¨ â†’ `plugins/core/managers/installer.ts`
   - è·¯ç”±ç®¡ç†å™¨ â†’ `plugins/core/managers/route-manager.ts`
   - è®¸å¯è¯æœåŠ¡ â†’ `plugins/core/services/license.ts`
   - éªŒè¯æœåŠ¡ â†’ `plugins/core/services/validator.ts`

3. **å•†ä¸šæ’ä»¶è¿ç§»**
   - å°† `commercial/plugins/payment/` è¿ç§»åˆ° `plugins/commercial/payment/`
   - ä¿æŒäº†ç°æœ‰å•†ä¸šæ’ä»¶çš„å®Œæ•´æ€§

4. **å¼€å‘èµ„æºåˆ›å»º**
   - åˆ›å»ºäº†ç»Ÿä¸€çš„å…¥å£æ–‡ä»¶ `plugins/core/index.ts`
   - æä¾›äº†åŸºç¡€æ’ä»¶æ¨¡æ¿ `plugins/templates/basic/`
   - åˆ›å»ºäº†å®˜æ–¹æ’ä»¶ç¤ºä¾‹ `plugins/official/payment/alipay/`
   - ç¼–å†™äº†è¯¦ç»†çš„å¼€å‘æ–‡æ¡£ `plugins/docs/getting-started.md`

5. **è·¯å¾„æ›´æ–°**
   - æ›´æ–°äº†æ‰€æœ‰å†…éƒ¨ import è·¯å¾„
   - ç¡®ä¿æ¨¡å—é—´çš„æ­£ç¡®å¼•ç”¨å…³ç³»

## ğŸš€ ä½¿ç”¨æ–°çš„æ’ä»¶ç³»ç»Ÿ

### å¯¼å…¥æ ¸å¿ƒæ¨¡å—

```typescript
// å¯¼å…¥å®Œæ•´çš„æ’ä»¶ç³»ç»Ÿ
import { createPluginSystem } from './plugins/core';

// å¯¼å…¥ç‰¹å®šç»„ä»¶
import {
  UnifiedPluginManager,
  PseudoHotSwapManager,
  OneClickInstaller
} from './plugins/core';

// å¯¼å…¥ç±»å‹å®šä¹‰
import {
  UnifiedPlugin,
  PluginType,
  PluginContext
} from './plugins/core/types';
```

### åˆå§‹åŒ–æ’ä»¶ç³»ç»Ÿ

```typescript
import { FastifyInstance } from 'fastify';
import { PrismaClient } from '@prisma/client';
import { createPluginSystem } from './plugins/core';

async function initializeApp(app: FastifyInstance, prisma: PrismaClient) {
  // åˆ›å»ºæ’ä»¶ç³»ç»Ÿ
  const pluginSystem = createPluginSystem(app, prisma);
  
  // åˆå§‹åŒ–
  await pluginSystem.initialize();
  
  // è·å–ç³»ç»ŸçŠ¶æ€
  const status = await pluginSystem.getSystemStatus();
  console.log('Plugin system status:', status);
}
```

### å¼€å‘æ–°æ’ä»¶

```bash
# 1. å¤åˆ¶åŸºç¡€æ¨¡æ¿
cp -r plugins/templates/basic plugins/community/my-new-plugin

# 2. ä¿®æ”¹æ’ä»¶ä¿¡æ¯
cd plugins/community/my-new-plugin
# ç¼–è¾‘ index.tsï¼Œä¿®æ”¹æ’ä»¶å…ƒæ•°æ®å’Œå®ç°

# 3. æµ‹è¯•æ’ä»¶
npm run test

# 4. å®‰è£…æ’ä»¶
# é€šè¿‡ç®¡ç†ç•Œé¢æˆ–APIå®‰è£…
```

## ğŸ”„ ä¸‹ä¸€æ­¥å·¥ä½œ

### ğŸš§ å¾…å®Œæˆä»»åŠ¡

1. **å®ç°ç»Ÿä¸€æ’ä»¶ç®¡ç†å™¨** (è¿›è¡Œä¸­)
   - åœ¨åº”ç”¨ä¸­é›†æˆæ–°çš„æ’ä»¶ç³»ç»Ÿ
   - æ›¿æ¢ç°æœ‰çš„åŒé‡æ’ä»¶æ¶æ„
   - æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

2. **è¿ç§»ç°æœ‰æ’ä»¶** (å¾…å¼€å§‹)
   - å°†ç°æœ‰çš„æ”¯ä»˜æ’ä»¶è¿ç§»åˆ°æ–°æ¶æ„
   - æ›´æ–°æ’ä»¶æ¥å£ä»¥ç¬¦åˆæ–°æ ‡å‡†
   - ç¡®ä¿å‘åå…¼å®¹æ€§

3. **æ›´æ–°åº”ç”¨é›†æˆ**
   - æ›´æ–°ä¸»åº”ç”¨ä¸­çš„æ’ä»¶å¼•ç”¨è·¯å¾„
   - ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œæ„å»ºè„šæœ¬
   - æ›´æ–°æ–‡æ¡£å’Œç¤ºä¾‹

### ğŸ“‹ å»ºè®®çš„å®æ–½é¡ºåº

1. **ç«‹å³**: åœ¨ä¸»åº”ç”¨ä¸­é›†æˆæ–°çš„æ’ä»¶ç³»ç»Ÿ
2. **çŸ­æœŸ**: è¿ç§»ç°æœ‰æ’ä»¶åˆ°æ–°æ¶æ„
3. **ä¸­æœŸ**: å¼€å‘æ›´å¤šå®˜æ–¹æ’ä»¶å’Œå·¥å…·
4. **é•¿æœŸ**: å»ºè®¾æ’ä»¶å¸‚åœºå’Œç¤¾åŒº

## ğŸ‰ é‡æ„ä¼˜åŠ¿

### ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

- **ç»Ÿä¸€æ€§**: æ‰€æœ‰æ’ä»¶éµå¾ªç›¸åŒçš„æ¥å£å’Œæ ‡å‡†
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ç›®å½•ç»“æ„ï¼Œæ˜“äºå®šä½å’Œä¿®æ”¹
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ

### ğŸ‘¨â€ğŸ’» å¼€å‘è€…å‹å¥½

- **æ¨¡æ¿æ”¯æŒ**: æä¾›äº†å®Œæ•´çš„æ’ä»¶å¼€å‘æ¨¡æ¿
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„å¼€å‘æŒ‡å—å’ŒAPIæ–‡æ¡£
- **å·¥å…·æ”¯æŒ**: å¼€å‘ã€æµ‹è¯•ã€æ‰“åŒ…å·¥å…·é“¾
- **ç¤ºä¾‹ä¸°å¯Œ**: å¤šç§ç±»å‹çš„æ’ä»¶ç¤ºä¾‹

### ğŸª å•†ä¸šåŒ–æ”¯æŒ

- **åˆ†å±‚æ¶æ„**: å…è´¹ã€ç¤¾åŒºã€å•†ä¸šæ’ä»¶åˆ†ç¦»
- **è®¸å¯è¯ç®¡ç†**: å®Œæ•´çš„è®¸å¯è¯éªŒè¯ç³»ç»Ÿ
- **ä¸€é”®å®‰è£…**: ç”¨æˆ·å‹å¥½çš„å®‰è£…ä½“éªŒ
- **çƒ­æ’æ‹”**: è¿è¡Œæ—¶å®‰è£…/å¸è½½æ”¯æŒ

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨æ–°æ’ä»¶ç³»ç»Ÿæ—¶é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [å¿«é€Ÿå…¥é—¨æŒ‡å—](./docs/getting-started.md)
2. å‚è€ƒ [API æ–‡æ¡£](./docs/api-reference.md)
3. æŸ¥çœ‹ [ç¤ºä¾‹æ’ä»¶](./official/payment/alipay/)
4. ä½¿ç”¨ [åŸºç¡€æ¨¡æ¿](./templates/basic/) å¼€å‘æ–°æ’ä»¶

---

ğŸŠ **æ­å–œï¼** æ’ä»¶ç³»ç»Ÿé‡æ„å·²å®Œæˆï¼Œç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªç°ä»£åŒ–ã€å¯æ‰©å±•çš„æ’ä»¶æ¶æ„ï¼
