// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String
  username  String
  password  String
  avatar    String?
  role      String   @default("USER") // 'USER', 'TENANT_ADMIN', 'SUPER_ADMIN'
  tenantId  Int      @default(1) // 0=SUPER_ADMIN, >0=ç§Ÿæˆ·ç”¨æˆ·
  tenant    Tenant?  @relation(fields: [tenantId], references: [id])
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ğŸ†• åˆ†é”€åˆ†æ¶¦å­—æ®µ
  referralCode         String? @unique // é‚€è¯·ç ï¼ˆç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨ç”Ÿæˆï¼‰
  invitedBy            String? // é‚€è¯·äººuserIdï¼ˆåªè®°å½•ç›´æ¥é‚€è¯·äººï¼‰
  customCommissionRate Float? // ä¸ªæ€§åŒ–åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼Œnullè¡¨ç¤ºä½¿ç”¨é»˜è®¤æ¯”ä¾‹
  totalEarnings        Float   @default(0) // ç´¯è®¡æ”¶ç›Š
  availableBalance     Float   @default(0) // å¯æç°ä½™é¢
  pendingBalance       Float   @default(0) // å¾…ç»“ç®—ä½™é¢ï¼ˆ7å¤©å†…ï¼‰
  totalReferrals       Int     @default(0) // é‚€è¯·äººæ•°

  // ç”µå•†ç›¸å…³å…³ç³»
  orders Order[]
  carts  Cart[] // ç”¨æˆ·è´­ç‰©è½¦å…³ç³»

  // Removed multilingual relations

  // OAuth 2.0 å’Œç¤¾äº¤ç™»å½•ç›¸å…³å…³ç³»
  socialAccounts SocialAccount[]
  oauth2Tokens   OAuth2AccessToken[]

  // å¤šç§Ÿæˆ·OEMç›¸å…³å…³ç³» - SalesåŠŸèƒ½å·²åˆ é™¤

  // å®¡è®¡æ—¥å¿—å…³ç³»
  auditLogs AuditLog[] @relation("UserAuditLogs")

  // ğŸ†• åˆ†é”€åˆ†æ¶¦å…³ç³»
  inviter     User?        @relation("UserReferrals", fields: [invitedBy], references: [id], onDelete: SetNull)
  referrals   User[]       @relation("UserReferrals")
  commissions Commission[]
  payouts     Payout[]

  // ğŸ†• ä»£ç†ç³»ç»Ÿå…³ç³»
  agents      Agent[]      // ç”¨æˆ·ä½œä¸ºä»£ç†ç®¡ç†å‘˜

  @@unique([email, tenantId], name: "user_email_tenant_unique")
  @@index([email])
  @@index([tenantId])
  @@index([role])
  @@index([referralCode])
  @@index([invitedBy])
  @@map("users")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float    // åŸºç¡€ä»·æ ¼ï¼ˆå‘åå…¼å®¹ï¼‰
  stock       Int      @default(0) // åŸºç¡€åº“å­˜ï¼ˆå‘åå…¼å®¹ï¼‰
  category    String?
  images      String?
  tenantId    Int
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ğŸ†• ä»£ç†æˆæƒæŒ‰é’®ï¼ˆå•†å“çº§ï¼‰
  agentCanDelegate Boolean @default(true) // æ˜¯å¦å…è®¸è¯¥å•†å“è¿›å…¥ä»£ç†ä½“ç³»

  // Relations
  orderItems            OrderItem[]
  cartItems             CartItem[] // è´­ç‰©è½¦å•†å“å…³ç³»
  inventoryReservations InventoryReservation[] // ğŸ†• åº“å­˜é¢„ç•™å…³ç³»
  translations          ProductTranslation[] // ğŸ†• å¤šè¯­è¨€ç¿»è¯‘å…³ç³»
  variants              ProductVariant[] // ğŸ†• å•†å“å˜ä½“å…³ç³»
  selfConfigs           AgentVariantSelfConfig[] // ğŸ†• Selfè·¯å¾„é…ç½®
  childrenConfigs       AgentVariantChildrenConfig[] // ğŸ†• Childrenè·¯å¾„é…ç½®

  @@index([tenantId])
  @@index([category])
  @@map("products")
}

// ğŸ†• å•†å“å˜ä½“è¡¨ (SKU)
// æ¯ä¸ªProductå¯ä»¥æœ‰å¤šä¸ªå˜ä½“ï¼Œå¦‚ä¸åŒå¤©æ•°çš„å¥—é¤
model ProductVariant {
  id          String   @id @default(cuid())
  productId   String
  tenantId    Int
  name        String   // å˜ä½“åç§°ï¼ˆå¦‚"1å¤©å¥—é¤"ã€"7å¤©å¥—é¤"ï¼‰
  attributes  String?  // JSONæ ¼å¼çš„å±æ€§ï¼ˆå¦‚ {"days": 1}ï¼‰
  basePrice   Float    // å˜ä½“åŸºç¡€ä»·æ ¼
  baseStock   Int      @default(0) // å˜ä½“åŸºç¡€åº“å­˜
  skuCode     String?  // SKUç¼–ç ï¼ˆå¯é€‰ï¼‰
  sortOrder   Int      @default(0) // æ’åº
  isActive    Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ğŸ†• ä»£ç†æˆæƒæŒ‰é’®ï¼ˆå˜ä½“çº§ï¼‰
  agentCanDelegate Boolean @default(true) // æ˜¯å¦å…è®¸è¯¥å˜ä½“è¿›å…¥ä»£ç†ä½“ç³»ä¸‹å‘ç»™ä¸‹çº§

  // Relations
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  orderItems  OrderItem[] // è®¢å•é¡¹å…³ç³»
  cartItems   CartItem[] // è´­ç‰©è½¦é¡¹å…³ç³»
  selfConfigs AgentVariantSelfConfig[] // Selfè·¯å¾„é…ç½®
  childrenConfigs AgentVariantChildrenConfig[] // Childrenè·¯å¾„é…ç½®
  inventoryReservations InventoryReservation[] // ğŸ†• åº“å­˜é¢„ç•™å…³ç³»

  @@index([productId])
  @@index([tenantId])
  @@index([skuCode])
  @@map("product_variants")
}

// ğŸ†• å•†å“å¤šè¯­è¨€ç¿»è¯‘è¡¨
// å­˜å‚¨å•†å“çš„å¤šè¯­è¨€å­—æ®µï¼Œæ”¯æŒ en å’Œ zh-Hant
model ProductTranslation {
  id          String   @id @default(cuid())
  productId   String
  locale      String   // 'en' | 'zh-Hant'
  name        String   // ç¿»è¯‘åçš„å•†å“åç§°
  description String?  // ç¿»è¯‘åçš„å•†å“æè¿°
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locale]) // æ¯ä¸ªå•†å“æ¯ç§è¯­è¨€åªèƒ½æœ‰ä¸€æ¡ç¿»è¯‘
  @@index([productId])
  @@index([locale])
  @@map("product_translations")
}

model Order {
  id     String @id @default(cuid())
  userId String
  status String @default("PENDING")

  // ğŸ†• æ”¯ä»˜çŠ¶æ€å­—æ®µ
  paymentStatus        String    @default("UNPAID") // UNPAID, PAID, FAILED, REFUNDED
  expiresAt            DateTime? // è®¢å•è¿‡æœŸæ—¶é—´ï¼ˆåˆ›å»ºå30åˆ†é’Ÿï¼‰
  lastPaymentAttemptAt DateTime? // æœ€åä¸€æ¬¡æ”¯ä»˜å°è¯•æ—¶é—´
  paymentAttempts      Int       @default(0) // æ”¯ä»˜å°è¯•æ¬¡æ•°
  lastPaymentMethod    String? // æœ€åä¸€æ¬¡ä½¿ç”¨çš„æ”¯ä»˜æ–¹å¼ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰£APIæ¬¡æ•°ï¼‰
  cancelReason         String? // å–æ¶ˆåŸå› 
  cancelledAt          DateTime? // å–æ¶ˆæ—¶é—´

  totalAmount     Float
  customerEmail   String?
  shippingAddress String?
  tenantId        Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // ğŸ†• åˆ†é”€åˆ†æ¶¦å­—æ®µ
  referrerId           String? // æ¨èäººuserIdï¼ˆä¸‹å•æ—¶è®°å½•ï¼Œç”¨äºä½£é‡‘è®¡ç®—ï¼‰
  commissionCalculated Boolean @default(false) // æ˜¯å¦å·²è®¡ç®—ä½£é‡‘

  // ğŸ†• ä»£ç†ç³»ç»Ÿå­—æ®µ
  agentId              String? // æ¥æºä»£ç†IDï¼ˆAgent Mallè®¢å•ï¼‰
  agentCommissionCalculated Boolean @default(false) // æ˜¯å¦å·²è®¡ç®—ä»£ç†ä½£é‡‘

  // Relations
  user                  User                   @relation(fields: [userId], references: [id])
  tenant                Tenant                 @relation(fields: [tenantId], references: [id])
  items                 OrderItem[]
  payments              Payment[]
  inventoryReservations InventoryReservation[] // ğŸ†• å…³è”åº“å­˜é¢„ç•™
  commissions           Commission[] // ğŸ†• ä½£é‡‘è®°å½•å…³ç³»
  agent                 Agent?                 @relation("AgentOrders", fields: [agentId], references: [id])
  agentCommissions      AgentCommission[] // ğŸ†• ä»£ç†ä½£é‡‘è®°å½•å…³ç³»

  @@index([status])
  @@index([paymentStatus]) // ğŸ†• æ–°å¢ç´¢å¼•
  @@index([expiresAt]) // ğŸ†• æ–°å¢ç´¢å¼•ï¼ˆç”¨äºå®šæ—¶ä»»åŠ¡æŸ¥è¯¢ï¼‰
  @@index([tenantId])
  @@index([userId, tenantId])
  @@index([referrerId]) // ğŸ†• æ–°å¢ç´¢å¼•
  @@index([agentId]) // ğŸ†• æ–°å¢ç´¢å¼•
  @@map("orders")
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  variantId String? // ğŸ†• å•†å“å˜ä½“IDï¼ˆæ–°å¢å­—æ®µï¼‰
  quantity  Int
  unitPrice Float
  tenantId  Int

  // Relations
  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id]) // ğŸ†• å˜ä½“å…³ç³»
  tenant  Tenant  @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([orderId, tenantId])
  @@index([variantId]) // ğŸ†• å˜ä½“ç´¢å¼•
  @@map("order_items")
}

// ğŸ†• åº“å­˜é¢„ç•™è¡¨ - ç”¨äºä¸´æ—¶é”å®šåº“å­˜
// ğŸ†• æ”¯æŒå˜ä½“çº§åº“å­˜é¢„ç•™
model InventoryReservation {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  variantId String?  // ğŸ†• å˜ä½“IDï¼ˆå¯é€‰ï¼Œå‘åå…¼å®¹ï¼‰
  quantity  Int
  tenantId  Int
  expiresAt DateTime // é¢„ç•™è¿‡æœŸæ—¶é—´ï¼ˆä¸è®¢å•è¿‡æœŸæ—¶é—´ä¸€è‡´ï¼‰
  status    String   @default("ACTIVE") // ACTIVE, RELEASED, CONFIRMED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order   Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product        @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])
  tenant  Tenant         @relation(fields: [tenantId], references: [id])

  @@unique([orderId, productId, variantId]) // ğŸ†• æ¯ä¸ªè®¢å•çš„æ¯ä¸ªå•†å“å˜ä½“åªèƒ½æœ‰ä¸€æ¡é¢„ç•™è®°å½•
  @@index([expiresAt, status]) // ç”¨äºå®šæ—¶ä»»åŠ¡æŸ¥è¯¢è¿‡æœŸé¢„ç•™
  @@index([productId, status]) // ç”¨äºè®¡ç®—å¯ç”¨åº“å­˜
  @@index([variantId, status]) // ğŸ†• ç”¨äºè®¡ç®—å˜ä½“å¯ç”¨åº“å­˜
  @@index([tenantId])
  @@map("inventory_reservations")
}

// è´­ç‰©è½¦ç³»ç»Ÿ - ä»…æ”¯æŒç™»å½•ç”¨æˆ·
model Cart {
  id        String   @id @default(cuid())
  userId    String // å¿…éœ€å­—æ®µï¼Œåªæ”¯æŒç™»å½•ç”¨æˆ·
  tenantId  Int // å¤šç§Ÿæˆ·éš”ç¦»
  status    String   @default("ACTIVE") // 'ACTIVE', 'CONVERTED'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user   User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant Tenant     @relation(fields: [tenantId], references: [id])
  items  CartItem[]

  // æ¯ä¸ªç”¨æˆ·åœ¨æ¯ä¸ªç§Ÿæˆ·åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒè´­ç‰©è½¦
  @@unique([userId, tenantId])
  @@index([userId])
  @@index([tenantId])
  @@index([status])
  @@map("carts")
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  quantity  Int
  price     Float // åŠ å…¥è´­ç‰©è½¦æ—¶çš„ä»·æ ¼å¿«ç…§
  variantId String? // å•†å“å˜ä½“IDï¼ˆå¯é€‰ï¼‰
  tenantId  Int // å¤šç§Ÿæˆ·éš”ç¦»
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  cart    Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id]) // ğŸ†• å˜ä½“å…³ç³»
  tenant  Tenant  @relation(fields: [tenantId], references: [id])

  // é˜²é‡å¤çº¦æŸï¼šåŒä¸€è´­ç‰©è½¦ä¸­åŒä¸€å•†å“ï¼ˆå«å˜ä½“ï¼‰åªèƒ½æœ‰ä¸€æ¡è®°å½•
  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
  @@index([variantId]) // ğŸ†• å˜ä½“ç´¢å¼•
  @@index([tenantId])
  @@map("cart_items")
}

// å¤šç§Ÿæˆ·OEMç³»ç»Ÿ

// ç§Ÿæˆ·
model Tenant {
  id               Int     @id @default(autoincrement())
  companyName      String
  contactName      String
  contactEmail     String  @unique
  contactPhone     String?
  domain           String? @unique // è‡ªå®šä¹‰åŸŸå
  subdomain        String? @unique // å­åŸŸå
  logo             String? // Logo URL
  theme            String? // JSONæ ¼å¼çš„ä¸»é¢˜é…ç½®
  branding         String? // JSONæ ¼å¼çš„å“ç‰Œé…ç½®
  settings         String? // JSONæ ¼å¼çš„ç§Ÿæˆ·è®¾ç½®
  status           String  @default("ACTIVE") // 'ACTIVE', 'SUSPENDED', 'TERMINATED'
  subscriptionTier String  @default("BASIC") // 'BASIC', 'PREMIUM', 'ENTERPRISE'
  maxUsers         Int     @default(10)
  maxProducts      Int     @default(100)

  // ğŸ†• è®¢é˜…ç›¸å…³è®¾ç½®
  billingEmail   String? // è´¦å•é‚®ç®±
  taxId          String? // ç¨åŠ¡ID
  billingAddress String? // JSONæ ¼å¼çš„è´¦å•åœ°å€

  // ğŸ†• é‚®ä»¶ç³»ç»Ÿé…ç½®
  defaultEmailProvider String? // é»˜è®¤é‚®ä»¶æä¾›å•† (e.g., 'resend-email')
  emailSettings        String? // JSONæ ¼å¼çš„é‚®ä»¶é…ç½®

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  users         User[]
  products      Product[]
  productVariants ProductVariant[] // ğŸ†• å•†å“å˜ä½“å…³ç³»
  orders        Order[]
  orderItems    OrderItem[]
  carts         Cart[] // ç§Ÿæˆ·è´­ç‰©è½¦å…³ç³»
  cartItems     CartItem[] // ç§Ÿæˆ·è´­ç‰©è½¦å•†å“å…³ç³»
  priceControls PriceControl[]
  tenantPricing TenantPricing[]

  dataSyncs TenantDataSync[]
  auditLogs AuditLog[]

  // Plugin system relations
  pluginInstallations PluginInstallation[]
  pluginUsage         PluginUsage[]
  payments            Payment[]

  // å•†ä¸šåŒ–æ¨¡å¼ç›¸å…³å…³ç³»
  customPricing    TenantCustomPricing[]
  featureOverrides TenantFeatureOverride[]
  usageOverrides   TenantUsageOverride[]

  // ğŸ†• è®¢é˜…ç³»ç»Ÿå…³ç³»
  subscriptions Subscription[]

  // ğŸ†• åº“å­˜é¢„ç•™å…³ç³»
  inventoryReservations InventoryReservation[]

  // ğŸ†• é‚®ä»¶ç³»ç»Ÿå…³ç³»
  emailLogs      EmailLog[]
  emailTemplates EmailTemplate[]
  emailQueue     EmailQueue[]

  // ğŸ†• åˆ†é”€åˆ†æ¶¦å…³ç³»
  commissionConfigs TenantCommissionConfig[]
  commissions       Commission[]
  payouts           Payout[]

  // ğŸ†• æ’ä»¶è®¸å¯è¯å…³ç³»ï¼ˆä¹°æ–­åˆ¶ï¼‰
  pluginLicenses    PluginLicense[]

  // ğŸ†• åŸŸåé…ç½®å…³ç³»
  domains           TenantDomain[]

  // ğŸ†• ä¸‰çº§ä»£ç†ç³»ç»Ÿå…³ç³»
  agents            Agent[]
  agentMallConfigs  AgentMallConfig[]
  agentDomains      AgentDomain[]
  agentLevelConfigs AgentLevelConfig[]
  agentCommissions  AgentCommission[]

  // ğŸ†• ä»£ç†å˜ä½“æˆæƒé…ç½®å…³ç³»
  agentVariantSelfConfigs     AgentVariantSelfConfig[]
  agentVariantChildrenConfigs AgentVariantChildrenConfig[]

  @@map("tenants")
}

// äº§å“ä»·æ ¼æ§åˆ¶
model PriceControl {
  id             String   @id @default(cuid())
  productType    String // 'plugin', 'saas-app', 'template'
  productId      String
  productName    String
  basePrice      Float // Jiffooè®¾ç½®çš„åº•ä»·
  suggestedPrice Float? // å»ºè®®å”®ä»·
  minPrice       Float? // æœ€ä½å”®ä»·é™åˆ¶
  maxPrice       Float? // æœ€é«˜å”®ä»·é™åˆ¶
  marginPercent  Float? // å»ºè®®åŠ ä»·ç™¾åˆ†æ¯”
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  tenant        Tenant          @relation(fields: [tenantId], references: [id])
  tenantId      Int
  tenantPricing TenantPricing[]

  @@index([productType])
  @@index([tenantId])
  @@index([isActive])
  @@map("price_controls")
}

// ç§Ÿæˆ·å®šä»·
model TenantPricing {
  id             String   @id @default(cuid())
  tenantId       Int
  priceControlId String
  sellingPrice   Float
  marginAmount   Float // åŠ ä»·é‡‘é¢
  marginPercent  Float // åŠ ä»·ç™¾åˆ†æ¯”
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  tenant       Tenant       @relation(fields: [tenantId], references: [id])
  priceControl PriceControl @relation(fields: [priceControlId], references: [id])

  @@index([tenantId])
  @@index([priceControlId])
  @@map("tenant_pricing")
}

// ç§Ÿæˆ·æ•°æ®åŒæ­¥é…ç½®
model TenantDataSync {
  id              String    @id @default(cuid())
  tenantId        Int
  syncType        String // 'users', 'orders', 'products', 'analytics'
  syncEndpoint    String // ç§Ÿæˆ·æ•°æ®æ¥æ”¶æ¥å£
  syncFrequency   String    @default("daily") // 'realtime', 'hourly', 'daily', 'weekly'
  authMethod      String    @default("api_key") // 'api_key', 'oauth2', 'webhook'
  authCredentials String // JSONæ ¼å¼çš„è®¤è¯ä¿¡æ¯
  isActive        Boolean   @default(true)
  lastSyncAt      DateTime?
  lastSyncStatus  String? // 'success', 'failed', 'partial'
  errorMessage    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([syncType])
  @@index([isActive])
  @@index([lastSyncAt])
  @@map("tenant_data_sync")
}

// æ“ä½œæ—¥å¿—
model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  tenantId   Int      @default(0) // 0=å¹³å°çº§æ“ä½œ, >0=ç§Ÿæˆ·æ“ä½œ
  action     String // 'CREATE', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT'
  module     String // 'users', 'tenants', 'sales', 'plugins'
  resourceId String? // è¢«æ“ä½œèµ„æºçš„ID
  oldValues  String? // JSONæ ¼å¼çš„æ—§å€¼
  newValues  String? // JSONæ ¼å¼çš„æ–°å€¼
  ipAddress  String?
  userAgent  String?
  metadata   String? // JSONæ ¼å¼çš„é¢å¤–å…ƒæ•°æ®
  createdAt  DateTime @default(now())

  // Relations
  user   User?   @relation("UserAuditLogs", fields: [userId], references: [id])
  tenant Tenant? @relation(fields: [tenantId], references: [id])

  @@index([userId])
  @@index([tenantId])
  @@index([action])
  @@index([module])
  @@index([createdAt])
  @@map("audit_logs")
}

// Removed multilingual support tables

// OAuth 2.0 å’Œç¤¾äº¤ç™»å½•ç›¸å…³è¡¨

// ç¤¾äº¤è´¦æˆ·è¡¨
model SocialAccount {
  id           String    @id @default(cuid())
  userId       String
  provider     String // 'wechat', 'google', 'github', 'alipay'
  providerId   String // ç¬¬ä¸‰æ–¹å¹³å°çš„ç”¨æˆ·ID
  accessToken  String? // è®¿é—®ä»¤ç‰Œ
  refreshToken String? // åˆ·æ–°ä»¤ç‰Œ
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerId])
  @@index([userId])
  @@index([provider])
  @@map("social_accounts")
}

// OAuth 2.0 æˆæƒç è¡¨
model OAuth2AuthorizationCode {
  id          String   @id @default(cuid())
  code        String   @unique
  state       String
  userId      String
  clientId    String
  redirectUri String
  expiresAt   DateTime
  createdAt   DateTime @default(now())

  @@index([code])
  @@index([expiresAt])
  @@map("oauth2_authorization_codes")
}

// OAuth 2.0 è®¿é—®ä»¤ç‰Œè¡¨
model OAuth2AccessToken {
  id               String    @id @default(cuid())
  accessToken      String    @unique
  refreshToken     String?   @unique
  userId           String
  clientId         String
  scope            String?
  expiresAt        DateTime
  refreshExpiresAt DateTime?
  revoked          Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([accessToken])
  @@index([refreshToken])
  @@index([userId])
  @@index([expiresAt])
  @@index([revoked])
  @@map("oauth2_access_tokens")
}

// ============================================
// æ’ä»¶ç³»ç»Ÿç›¸å…³è¡¨
// ============================================

// æ’ä»¶è¡¨
model Plugin {
  id              String  @id @default(cuid())
  slug            String  @unique // 'stripe-payment'
  name            String // 'Stripeæ”¯ä»˜'
  description     String?
  longDescription String? // è¯¦ç»†æè¿°
  category        String? // 'payment', 'marketing', 'analytics'
  tags            String? // JSONæ•°ç»„æ ¼å¼çš„æ ‡ç­¾
  iconUrl         String? // æ’ä»¶å›¾æ ‡URL
  screenshots     String? // JSONæ•°ç»„æ ¼å¼çš„æˆªå›¾URLs
  version         String  @default("1.0.0")
  status          String  @default("ACTIVE") // 'ACTIVE', 'INACTIVE'
  // ğŸ”§ å•†ä¸šæ¨¡å¼ä¿¡æ¯ç°åœ¨ä»subscription_plansè¡¨æ¨æ–­

  // ğŸ†• æ’ä»¶å…ƒæ•°æ®
  developer    String? @default("Jiffoo") // å¼€å‘è€…åç§°
  rating       Float?  @default(0) // è¯„åˆ† (0-5)
  installCount Int     @default(0) // å®‰è£…æ¬¡æ•°

  // ğŸ†• å¤–éƒ¨æ’ä»¶æ”¯æŒ
  runtimeType        String? @default("internal-fastify") // 'internal-fastify' | 'external-http'
  externalBaseUrl    String? // å¤–éƒ¨æ’ä»¶çš„åŸºç¡€URL
  oauthConfig        String? // JSONæ ¼å¼çš„OAuthé…ç½®ï¼š{installUrl, tokenUrl, redirectUri, scopes}
  integrationSecrets String? // JSONæ ¼å¼çš„é›†æˆå¯†é’¥ï¼š{sharedSecret}

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  installations     PluginInstallation[]
  customPricing     TenantCustomPricing[]
  subscriptions     Subscription[] // ğŸ†• è®¢é˜…å…³ç³»
  subscriptionPlans SubscriptionPlan[] // ğŸ†• è®¢é˜…è®¡åˆ’å…³ç³»
  payments          Payment[] // ğŸ†• æ”¯ä»˜è®°å½•å…³ç³»
  emailLogs         EmailLog[] // ğŸ†• é‚®ä»¶æ—¥å¿—å…³ç³»
  licenses          PluginLicense[] // ğŸ†• æ’ä»¶è®¸å¯è¯å…³ç³»ï¼ˆä¹°æ–­åˆ¶ï¼‰

  @@map("plugins")
}

// æ’ä»¶å®‰è£…è¡¨
model PluginInstallation {
  id       String  @id @default(cuid())
  tenantId Int
  pluginId String
  status   String  @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'TRIAL', 'EXPIRED'
  enabled  Boolean @default(true) // æ˜¯å¦å¯ç”¨

  // ğŸ†• å®‰è£…å’Œè¯•ç”¨ä¿¡æ¯
  installedAt    DateTime  @default(now()) // å®‰è£…æ—¶é—´
  trialStartDate DateTime? // è¯•ç”¨å¼€å§‹æ—¶é—´
  trialEndDate   DateTime? // è¯•ç”¨ç»“æŸæ—¶é—´

  // ğŸ†• é…ç½®æ•°æ®
  configData String? // JSONæ ¼å¼çš„æ’ä»¶é…ç½®æ•°æ®

  // ğŸ†• å¤–éƒ¨æ’ä»¶å®‰è£…ä¿¡æ¯
  externalInstallationId String? // å¤–éƒ¨æ’ä»¶çš„å®‰è£…IDï¼ˆå¦‚OAuthæµç¨‹ä¸­è·å¾—ï¼‰
  accessToken            String? // å¤–éƒ¨æ’ä»¶çš„è®¿é—®ä»¤ç‰Œ
  refreshToken           String? // å¤–éƒ¨æ’ä»¶çš„åˆ·æ–°ä»¤ç‰Œ
  tokenExpiresAt         DateTime? // è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
  plugin Plugin @relation(fields: [pluginId], references: [id])

  @@unique([tenantId, pluginId])
  @@index([externalInstallationId])
  @@map("plugin_installations")
}

// æ’ä»¶ä½¿ç”¨é‡è¡¨
model PluginUsage {
  id         String   @id @default(cuid())
  tenantId   Int
  pluginSlug String
  metricName String // 'transactions', 'api_calls', etc.
  value      Int      @default(0)
  period     String // '2024-01' (å¹´-æœˆ)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, pluginSlug, metricName, period], name: "tenantId_pluginSlug_metricName_period")
  @@map("plugin_usage")
}

// æ”¯ä»˜è®°å½•è¡¨
model Payment {
  id       String @id @default(cuid())
  orderId  String
  tenantId Int

  // ğŸ†• å…³è”åˆ°æ’ä»¶ - ç”¨äºè¿½è¸ªå“ªä¸ªæ”¯ä»˜æ’ä»¶å¤„ç†çš„æ”¯ä»˜
  pluginId String?
  plugin   Plugin? @relation(fields: [pluginId], references: [id])

  // ğŸ†• æ”¯ä»˜é‡è¯•ç›¸å…³å­—æ®µ
  attemptNumber Int       @default(1) // ç¬¬å‡ æ¬¡æ”¯ä»˜å°è¯•
  expiresAt     DateTime? // æ”¯ä»˜ä¼šè¯è¿‡æœŸæ—¶é—´ï¼ˆStripe Session 24å°æ—¶ï¼‰
  failureReason String? // å¤±è´¥åŸå› 

  paymentMethod   String // 'stripe', 'paypal', etc. - ç”¨äºæ˜¾ç¤º
  paymentIntentId String? // Stripe Payment Intent ID
  sessionId       String? // Stripe Checkout Session ID
  sessionUrl      String? // ğŸ†• Stripe Checkout Session URL - ç”¨äºSessionå¤ç”¨
  amount          Float
  currency        String   @default("USD")
  status          String   @default("PENDING") // 'PENDING', 'SUCCEEDED', 'FAILED'
  metadata        String? // JSONæ ¼å¼çš„é¢å¤–æ•°æ®
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  order  Order  @relation(fields: [orderId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([pluginId]) // ğŸ†• æ–°å¢ç´¢å¼•
  @@index([paymentIntentId])
  @@index([sessionId])
  @@index([orderId, attemptNumber]) // ğŸ†• æ–°å¢ç´¢å¼•
  @@map("payments")
}

// ç§Ÿæˆ·å®šåˆ¶å®šä»·è¡¨ - æ”¯æŒå•†ä¸šåŒ–æ¨¡å¼
model TenantCustomPricing {
  id        String    @id @default(cuid())
  tenantId  Int
  pluginId  String
  planId    String // 'custom_enterprise', 'vip_plan', etc.
  pricing   String // JSONæ ¼å¼çš„å®šåˆ¶å®šä»·ä¿¡æ¯
  features  String // JSONæ ¼å¼çš„åŠŸèƒ½åˆ—è¡¨ï¼ˆè¦†ç›–æ ‡å‡†åŠŸèƒ½ï¼‰
  limits    String // JSONæ ¼å¼çš„ä½¿ç”¨é‡é™åˆ¶ï¼ˆè¦†ç›–æ ‡å‡†é™åˆ¶ï¼‰
  validFrom DateTime  @default(now())
  validTo   DateTime?
  createdBy String // åˆ›å»ºæ­¤å®šåˆ¶æ–¹æ¡ˆçš„è¶…çº§ç®¡ç†å‘˜ID
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
  plugin Plugin @relation(fields: [pluginId], references: [id])

  @@unique([tenantId, pluginId])
  @@index([tenantId])
  @@index([pluginId])
  @@map("tenant_custom_pricing")
}

// ç§Ÿæˆ·åŠŸèƒ½è¦†ç›–è¡¨ - ç²¾ç»†åŒ–åŠŸèƒ½æ§åˆ¶
model TenantFeatureOverride {
  id         String   @id @default(cuid())
  tenantId   Int
  pluginSlug String
  feature    String // åŠŸèƒ½åç§°ï¼Œå¦‚ 'advanced_analytics'
  enabled    Boolean // true=å¼ºåˆ¶å¯ç”¨, false=å¼ºåˆ¶ç¦ç”¨
  reason     String? // è¦†ç›–åŸå› ï¼Œå¦‚ 'VIPå®¢æˆ·ç‰¹æƒ' æˆ– 'å®‰å…¨é™åˆ¶'
  createdBy  String // æ“ä½œçš„è¶…çº§ç®¡ç†å‘˜ID
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, pluginSlug, feature])
  @@index([tenantId])
  @@index([pluginSlug])
  @@map("tenant_feature_overrides")
}

// ç§Ÿæˆ·ä½¿ç”¨é‡è¦†ç›–è¡¨ - çµæ´»çš„é™åˆ¶æ§åˆ¶
model TenantUsageOverride {
  id         String    @id @default(cuid())
  tenantId   Int
  pluginSlug String
  metricName String // 'transactions', 'api_calls', etc.
  limitValue Int // -1 è¡¨ç¤ºæ— é™åˆ¶
  reason     String? // è¦†ç›–åŸå› 
  createdBy  String // æ“ä½œçš„è¶…çº§ç®¡ç†å‘˜ID
  validFrom  DateTime  @default(now())
  validTo    DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, pluginSlug, metricName])
  @@index([tenantId])
  @@index([pluginSlug])
  @@map("tenant_usage_overrides")
}

// ============================================
// è®¢é˜…ç³»ç»Ÿç›¸å…³è¡¨
// ============================================

// è®¢é˜…è¡¨ï¼ˆæ ¸å¿ƒè¡¨ï¼‰
model Subscription {
  id                   String  @id @default(cuid())
  tenantId             Int
  pluginId             String
  planId               String // è®¢é˜…è®¡åˆ’ID
  stripeSubscriptionId String?
  stripeItemId         String? // Stripe Subscription Item ID (required for proration updates)
  stripeCustomerId     String? // Stripeå®¢æˆ·ID

  // è®¢é˜…çŠ¶æ€å’Œå‘¨æœŸ
  status             String // 'trialing', 'active', 'past_due', 'canceled', 'unpaid'
  billingCycle       String // 'monthly', 'yearly', 'quarterly'
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  trialStart         DateTime?
  trialEnd           DateTime?

  // å®šä»·å’Œè®¡è´¹
  amount          Float
  currency        String @default("USD")
  taxRate         Float? @default(0)
  discountPercent Float? @default(0)

  // è®¢é˜…æ§åˆ¶
  cancelAtPeriodEnd Boolean   @default(false)
  canceledAt        DateTime?
  pausedAt          DateTime?
  resumeAt          DateTime?

  // è‡ªåŠ¨åŒ–è®¾ç½®
  autoRenew               Boolean @default(true)
  renewalNotificationSent Boolean @default(false)

  // å…ƒæ•°æ®
  metadata  String? // JSONæ ¼å¼
  notes     String? // ç®¡ç†å‘˜å¤‡æ³¨
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // å…³ç³»
  tenant   Tenant                @relation(fields: [tenantId], references: [id])
  plugin   Plugin                @relation(fields: [pluginId], references: [id])
  invoices SubscriptionInvoice[]
  changes  SubscriptionChange[]
  events   SubscriptionEvent[]

  // Removed @@unique([tenantId, pluginId]) to allow multiple subscription records per tenant-plugin pair
  // This enables keeping historical subscription records (canceled, expired, etc.)
  // Application logic ensures only one active/trialing subscription exists at a time
  @@index([status])
  @@index([currentPeriodEnd])
  @@index([stripeSubscriptionId])
  @@index([tenantId, pluginId, status]) // Composite index for efficient queries
  @@map("subscriptions")
}

// è®¢é˜…å˜æ›´è®°å½•è¡¨
model SubscriptionChange {
  id              String   @id @default(cuid())
  subscriptionId  String
  changeType      String // 'created', 'upgraded', 'downgraded', 'canceled', 'reactivated', 'paused', 'resumed'
  fromPlanId      String?
  toPlanId        String?
  fromAmount      Float?
  toAmount        Float?
  effectiveDate   DateTime
  prorationAmount Float? // æŒ‰æ¯”ä¾‹è®¡è´¹é‡‘é¢
  reason          String? // å˜æ›´åŸå› 
  initiatedBy     String // 'tenant', 'admin', 'system', 'stripe'
  createdBy       String? // æ“ä½œäººID
  metadata        String? // JSONæ ¼å¼çš„é¢å¤–ä¿¡æ¯
  createdAt       DateTime @default(now())

  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@index([subscriptionId])
  @@index([changeType])
  @@index([effectiveDate])
  @@map("subscription_changes")
}

// è®¢é˜…å‘ç¥¨è¡¨
model SubscriptionInvoice {
  id              String  @id @default(cuid())
  subscriptionId  String
  stripeInvoiceId String? @unique
  invoiceNumber   String  @unique // è‡ªåŠ¨ç”Ÿæˆçš„å‘ç¥¨å·

  // å‘ç¥¨åŸºæœ¬ä¿¡æ¯
  amount         Float
  taxAmount      Float  @default(0)
  discountAmount Float  @default(0)
  totalAmount    Float // amount + taxAmount - discountAmount
  currency       String @default("USD")

  // å‘ç¥¨çŠ¶æ€å’Œæ—¶é—´
  status      String // 'draft', 'open', 'paid', 'void', 'uncollectible'
  periodStart DateTime
  periodEnd   DateTime
  issueDate   DateTime  @default(now())
  dueDate     DateTime?
  paidAt      DateTime?
  voidedAt    DateTime?

  // æ”¯ä»˜ä¿¡æ¯
  paymentMethod    String? // 'stripe', 'manual', 'bank_transfer'
  paymentReference String? // æ”¯ä»˜å‚è€ƒå·

  // å‘ç¥¨å†…å®¹
  lineItems String // JSONæ ¼å¼çš„å‘ç¥¨æ˜ç»†
  metadata  String? // JSONæ ¼å¼
  notes     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@index([subscriptionId])
  @@index([status])
  @@index([dueDate])
  @@index([issueDate])
  @@map("subscription_invoices")
}

// è®¢é˜…äº‹ä»¶æ—¥å¿—è¡¨
model SubscriptionEvent {
  id               String    @id @default(cuid())
  subscriptionId   String
  eventType        String // 'created', 'activated', 'payment_succeeded', 'payment_failed', 'canceled', etc.
  eventSource      String // 'stripe', 'system', 'admin', 'tenant'
  eventData        String // JSONæ ¼å¼çš„äº‹ä»¶æ•°æ®
  processedAt      DateTime? // äº‹ä»¶å¤„ç†æ—¶é—´
  processingStatus String    @default("pending") // 'pending', 'processed', 'failed'
  errorMessage     String? // å¤„ç†å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
  retryCount       Int       @default(0)
  createdAt        DateTime  @default(now())

  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@index([subscriptionId])
  @@index([eventType])
  @@index([processingStatus])
  @@index([createdAt])
  @@map("subscription_events")
}

// è®¢é˜…è®¡åˆ’æ¨¡æ¿è¡¨ï¼ˆé¢„å®šä¹‰çš„è®¢é˜…è®¡åˆ’ï¼‰
model SubscriptionPlan {
  id          String  @id @default(cuid())
  pluginId    String
  planId      String // 'basic_monthly', 'pro_yearly', etc.
  name        String // 'åŸºç¡€æœˆä»˜è®¡åˆ’'
  description String?

  // å®šä»·ä¿¡æ¯
  amount        Float
  currency      String  @default("USD")
  billingCycle  String // 'monthly', 'yearly', 'quarterly'
  trialDays     Int?    @default(0)
  stripePriceId String? // Stripe Price ID for checkout (e.g., 'price_xxx')

  // åŠŸèƒ½å’Œé™åˆ¶
  features String // JSONæ ¼å¼çš„åŠŸèƒ½åˆ—è¡¨
  limits   String // JSONæ ¼å¼çš„ä½¿ç”¨é‡é™åˆ¶

  // è®¡åˆ’æ§åˆ¶
  isActive  Boolean @default(true)
  isPublic  Boolean @default(true) // æ˜¯å¦å¯¹æ‰€æœ‰ç§Ÿæˆ·å¯è§
  sortOrder Int     @default(0)

  // å…ƒæ•°æ®
  metadata  String? // JSONæ ¼å¼
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  plugin Plugin @relation(fields: [pluginId], references: [id])

  @@unique([pluginId, planId])
  @@index([pluginId])
  @@index([isActive])
  @@map("subscription_plans")
}

// ============================================
// é‚®ä»¶ç³»ç»Ÿè¡¨
// ============================================

// é‚®ä»¶å‘é€æ—¥å¿—è¡¨
model EmailLog {
  id       String  @id @default(cuid())
  tenantId Int
  pluginId String? // å…³è”åˆ°å…·ä½“çš„é‚®ä»¶æ’ä»¶
  provider String // 'resend', 'sendgrid', 'mailgun', 'aws-ses'

  // é‚®ä»¶æ ‡è¯†
  messageId  String? // æä¾›å•†è¿”å›çš„æ¶ˆæ¯ID
  externalId String? // å¤–éƒ¨ç³»ç»Ÿçš„å…³è”ID (e.g., orderId, userId)

  // é‚®ä»¶å†…å®¹
  to       String // JSONæ ¼å¼çš„æ”¶ä»¶äººåˆ—è¡¨
  from     String // å‘ä»¶äººåœ°å€
  fromName String? // å‘ä»¶äººåç§°
  replyTo  String? // å›å¤åœ°å€
  cc       String? // JSONæ ¼å¼çš„æŠ„é€åˆ—è¡¨
  bcc      String? // JSONæ ¼å¼çš„å¯†é€åˆ—è¡¨
  subject  String
  html     String? @db.Text
  text     String? @db.Text

  // é™„ä»¶ä¿¡æ¯
  attachments String? // JSONæ ¼å¼çš„é™„ä»¶åˆ—è¡¨

  // çŠ¶æ€è¿½è¸ª
  status String // 'queued', 'sent', 'delivered', 'opened', 'clicked', 'bounced', 'failed', 'spam'

  // æ—¶é—´æˆ³
  queuedAt    DateTime? // åŠ å…¥é˜Ÿåˆ—æ—¶é—´
  sentAt      DateTime? // å‘é€æ—¶é—´
  deliveredAt DateTime? // é€è¾¾æ—¶é—´
  openedAt    DateTime? // é¦–æ¬¡æ‰“å¼€æ—¶é—´
  clickedAt   DateTime? // é¦–æ¬¡ç‚¹å‡»æ—¶é—´
  bouncedAt   DateTime? // é€€ä¿¡æ—¶é—´

  // è¿½è¸ªæ•°æ®
  openCount  Int @default(0) // æ‰“å¼€æ¬¡æ•°
  clickCount Int @default(0) // ç‚¹å‡»æ¬¡æ•°

  // é”™è¯¯ä¿¡æ¯
  errorCode    String? // é”™è¯¯ä»£ç 
  errorMessage String? // é”™è¯¯è¯¦æƒ…

  // å…ƒæ•°æ®
  metadata String? // JSONæ ¼å¼çš„é¢å¤–æ•°æ®
  tags     String? // JSONæ ¼å¼çš„æ ‡ç­¾

  // é‡è¯•ä¿¡æ¯
  retryCount  Int       @default(0)
  lastRetryAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant  @relation(fields: [tenantId], references: [id])
  plugin Plugin? @relation(fields: [pluginId], references: [id])

  @@index([tenantId])
  @@index([pluginId])
  @@index([provider])
  @@index([status])
  @@index([sentAt])
  @@index([messageId])
  @@index([externalId])
  @@map("email_logs")
}

// é‚®ä»¶æ¨¡æ¿è¡¨
model EmailTemplate {
  id       String @id @default(cuid())
  tenantId Int

  // æ¨¡æ¿æ ‡è¯†
  slug        String // 'order-confirmation', 'password-reset', 'welcome'
  name        String // 'è®¢å•ç¡®è®¤é‚®ä»¶'
  description String?
  category    String // 'transactional', 'marketing', 'system'

  // æ¨¡æ¿å†…å®¹
  subject String // æ”¯æŒå˜é‡: "Order #{{orderId}} Confirmed"
  html    String  @db.Text // HTMLæ¨¡æ¿
  text    String? @db.Text // çº¯æ–‡æœ¬æ¨¡æ¿

  // æ¨¡æ¿å˜é‡å®šä¹‰
  variables String? // JSONæ ¼å¼: ["orderId", "customerName", "totalAmount"]

  // é»˜è®¤é…ç½®
  fromName  String? // è¦†ç›–ç§Ÿæˆ·é»˜è®¤å‘ä»¶äººåç§°
  fromEmail String? // è¦†ç›–ç§Ÿæˆ·é»˜è®¤å‘ä»¶äººåœ°å€
  replyTo   String? // è¦†ç›–ç§Ÿæˆ·é»˜è®¤å›å¤åœ°å€

  // çŠ¶æ€
  isActive Boolean @default(true)
  isSystem Boolean @default(false) // ç³»ç»Ÿæ¨¡æ¿ä¸å¯åˆ é™¤

  // ç‰ˆæœ¬æ§åˆ¶
  version Int @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([category])
  @@map("email_templates")
}

// é‚®ä»¶å‘é€é˜Ÿåˆ—è¡¨
model EmailQueue {
  id       String @id @default(cuid())
  tenantId Int
  provider String // æŒ‡å®šä½¿ç”¨çš„æä¾›å•†

  // é‚®ä»¶æ•°æ®
  emailData String @db.Text // JSONæ ¼å¼çš„å®Œæ•´é‚®ä»¶æ•°æ®

  // é˜Ÿåˆ—çŠ¶æ€
  status   String @default("pending") // 'pending', 'processing', 'sent', 'failed'
  priority Int    @default(5) // 1-10, æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜

  // è°ƒåº¦ä¿¡æ¯
  scheduledAt DateTime? // å®šæ—¶å‘é€æ—¶é—´
  processedAt DateTime?

  // é‡è¯•ä¿¡æ¯
  retryCount  Int       @default(0)
  maxRetries  Int       @default(3)
  nextRetryAt DateTime?

  // é”™è¯¯ä¿¡æ¯
  errorMessage String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([status])
  @@index([scheduledAt])
  @@index([priority])
  @@map("email_queue")
}

// ============================================
// åˆ†é”€åˆ†æ¶¦ç³»ç»Ÿè¡¨
// ============================================

// ä½£é‡‘è®°å½•è¡¨
model Commission {
  id          String @id @default(cuid())
  tenantId    Int
  userId      String // è·å¾—ä½£é‡‘çš„ç”¨æˆ·ï¼ˆæ¨èäººï¼‰
  orderId     String // å…³è”è®¢å•
  buyerId     String // è´­ä¹°ç”¨æˆ·

  orderAmount Float // è®¢å•é‡‘é¢
  rate        Float // ä½¿ç”¨çš„åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰
  amount      Float // ä½£é‡‘é‡‘é¢

  status String @default("PENDING") // PENDING(å¾…ç»“ç®—), SETTLED(å·²ç»“ç®—å¯æç°), PAID(å·²æ”¯ä»˜), REFUNDED(å·²é€€æ¬¾)

  // æ—¶é—´ä¿¡æ¯
  settleAt   DateTime  // ç»“ç®—æ—¶é—´ï¼ˆæ”¯ä»˜æˆåŠŸå7å¤©ï¼‰
  settledAt  DateTime? // å®é™…ç»“ç®—æ—¶é—´
  paidAt     DateTime? // æ”¯ä»˜æ—¶é—´
  refundedAt DateTime? // é€€æ¬¾æ—¶é—´

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
  user   User   @relation(fields: [userId], references: [id])
  order  Order  @relation(fields: [orderId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([orderId])
  @@index([status])
  @@index([settleAt]) // ç”¨äºå®šæ—¶ä»»åŠ¡
  @@map("commissions")
}

// ç§Ÿæˆ·åˆ†æ¶¦é…ç½®è¡¨
model TenantCommissionConfig {
  id      String @id @default(cuid())
  tenantId Int   @unique

  enabled Boolean @default(false) // æ˜¯å¦å¯ç”¨åˆ†é”€åŠŸèƒ½

  defaultRate Float @default(30) // é»˜è®¤åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰

  settlementDays  Int   @default(7) // ç»“ç®—å‘¨æœŸï¼ˆå¤©ï¼‰
  minPayoutAmount Float @default(50) // æœ€ä½æç°é‡‘é¢

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@map("tenant_commission_configs")
}

// æç°è®°å½•è¡¨
model Payout {
  id       String @id @default(cuid())
  tenantId Int
  userId   String

  amount   Float  // æç°é‡‘é¢
  currency String @default("USD")
  status   String @default("PENDING") // PENDING(å¾…å¤„ç†), PROCESSING(å¤„ç†ä¸­), COMPLETED(å·²å®Œæˆ), FAILED(å¤±è´¥), CANCELLED(å·²å–æ¶ˆ)

  // æ”¯ä»˜æ–¹å¼å’Œè´¦æˆ·ä¿¡æ¯
  method      String? // BANK_TRANSFER, PAYPAL, ALIPAY, WECHAT
  accountInfo String? // JSONæ ¼å¼å­˜å‚¨è´¦æˆ·ä¿¡æ¯

  // å¤„ç†ä¿¡æ¯
  processedAt   DateTime?
  processedBy   String? // å¤„ç†äººuserId
  failureReason String?
  note          String? // å¤‡æ³¨

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([status])
  @@map("payouts")
}

// ğŸ†• æ’ä»¶è®¸å¯è¯è¡¨ï¼ˆä¹°æ–­åˆ¶æ¨¡å‹ï¼‰
model PluginLicense {
  id              String   @id @default(cuid())
  tenantId        Int
  pluginId        String

  // è®¸å¯è¯çŠ¶æ€
  status          String   @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'SUSPENDED'
  purchaseDate    DateTime @default(now()) // è´­ä¹°æ—¥æœŸ
  activatedAt     DateTime? // æ¿€æ´»æ—¥æœŸ
  deactivatedAt   DateTime? // åœç”¨æ—¥æœŸ

  // è´­ä¹°ä¿¡æ¯
  amount          Float    @default(29) // è´­ä¹°é‡‘é¢ï¼ˆ$29ï¼‰
  currency        String   @default("USD") // è´§å¸

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id])
  plugin          Plugin   @relation(fields: [pluginId], references: [id])

  @@unique([tenantId, pluginId])
  @@index([status])
  @@index([tenantId])
  @@map("plugin_licenses")
}

// ğŸ†• ç§Ÿæˆ·åŸŸåé…ç½®
// æ”¯æŒå¤šåŸŸåç»‘å®šï¼šå‰å°ã€åå°ã€API åˆ†åˆ«å¯¹åº”ä¸åŒçš„åŸŸå
model TenantDomain {
  id        String   @id @default(cuid())
  tenantId  Int
  host      String   // å®Œæ•´åŸŸåï¼ˆå¦‚ bamboi.comã€admin.bamboi.comï¼‰
  appType   String   // 'frontend' | 'admin' | 'api' | 'tenant-admin' | 'agent-admin' | 'frontend-agent'
  isCustom  Boolean  @default(true)  // æ˜¯å¦è‡ªå®šä¹‰åŸŸåï¼ˆéå¹³å°åˆ†é…ï¼‰
  isPrimary Boolean  @default(false) // æ˜¯å¦ä¸ºè¯¥ appType ä¸‹çš„ä¸»åŸŸå

  // SSL/éªŒè¯çŠ¶æ€ï¼ˆå¯é€‰æ‰©å±•ï¼‰
  sslConfigured Boolean  @default(false)
  dnsVerified   Boolean  @default(false)
  verifiedAt    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([host, appType])
  @@index([tenantId])
  @@index([host])
  @@map("tenant_domains")
}

// ============================================
// ğŸ†• ä¸‰çº§ä»£ç†ç³»ç»Ÿæ¨¡å‹
// ============================================

// ä»£ç†å®ä½“ - å½’å±æŸä¸ªç§Ÿæˆ·
model Agent {
  id                String   @id @default(cuid())
  tenantId          Int      // å½’å±çš„ç§Ÿæˆ·
  userId            String   // ä»£ç†ç®¡ç†å‘˜è´¦å·ï¼ˆå¿…é¡»ç»‘å®šä¸€ä¸ªç”¨æˆ·ï¼‰
  code              String   // ä»£ç†ç ï¼ˆç”¨äºé‚€è¯·é“¾æ¥å’ŒMallè¯†åˆ«ï¼‰
  name              String   // ä»£ç†åç§°
  level             Int      // ä»£ç†ç­‰çº§ï¼š1/2/3
  parentAgentId     String?  // ä¸Šçº§ä»£ç†IDï¼ˆL2çš„ä¸Šçº§æ˜¯L1ï¼ŒL3çš„ä¸Šçº§æ˜¯L2ï¼‰
  status            String   @default("PENDING") // PENDING(å¾…å®¡æ ¸), ACTIVE(æ´»è·ƒ), SUSPENDED(åœç”¨), REJECTED(æ‹’ç»)

  // é‚€è¯·é“¾è·¯è¿½è¸ª
  invitedByTenantId Int?     // è¢«å“ªä¸ªç§Ÿæˆ·é‚€è¯·ï¼ˆé€šå¸¸ä¸tenantIdç›¸åŒï¼‰
  invitedByAgentId  String?  // è¢«å“ªä¸ªä»£ç†é‚€è¯·ï¼ˆç”¨äºä¸‹çº§ä»£ç†ï¼‰

  // ä¸šç»©ç»Ÿè®¡ï¼ˆå†—ä½™å­—æ®µï¼Œå®šæ—¶ä»»åŠ¡æ›´æ–°ï¼‰
  totalOrders       Int      @default(0)  // æ€»è®¢å•æ•°
  totalSales        Float    @default(0)  // æ€»é”€å”®é¢
  totalCommission   Float    @default(0)  // æ€»ä½£é‡‘
  availableBalance  Float    @default(0)  // å¯æç°ä½™é¢
  pendingBalance    Float    @default(0)  // å¾…ç»“ç®—ä½™é¢

  notes             String?  // å¤‡æ³¨

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user              User     @relation(fields: [userId], references: [id])
  parentAgent       Agent?   @relation("AgentHierarchy", fields: [parentAgentId], references: [id])
  childAgents       Agent[]  @relation("AgentHierarchy")

  // ä»£ç†Mallé…ç½®
  mallConfig        AgentMallConfig?
  // ä»£ç†åŸŸåé…ç½®
  domains           AgentDomain[]
  // ä»£ç†ä½£é‡‘è®°å½•
  agentCommissions  AgentCommission[]
  // å…³è”è®¢å•
  orders            Order[]  @relation("AgentOrders")
  // ğŸ†• å˜ä½“çº§æˆæƒé…ç½® - é€šè¿‡ ownerType='AGENT' + ownerId=agent.id é€»è¾‘å…³è”

  @@unique([tenantId, code])  // æ¯ä¸ªç§Ÿæˆ·å†…ä»£ç†ç å”¯ä¸€
  @@unique([tenantId, userId]) // æ¯ä¸ªç”¨æˆ·åœ¨æ¯ä¸ªç§Ÿæˆ·åªèƒ½æ˜¯ä¸€ä¸ªä»£ç†
  @@index([tenantId])
  @@index([userId])
  @@index([parentAgentId])
  @@index([level])
  @@index([status])
  @@map("agents")
}

// ä»£ç†Mallé…ç½®
model AgentMallConfig {
  id                 String   @id @default(cuid())
  agentId            String   @unique
  tenantId           Int

  // ä¸»é¢˜é…ç½®
  themeSlug          String?  // ä¸»é¢˜slugï¼ˆå¼•ç”¨Shopä¸»é¢˜ï¼‰
  themeConfig        String?  // JSONæ ¼å¼çš„ä¸»é¢˜é…ç½®

  // åº—é“ºè®¾ç½®
  settings           String?  // JSONæ ¼å¼ï¼š{shopName, description, banner, contact, etc.}

  // åŸŸåç±»å‹åå¥½
  defaultDomainType  String   @default("platform") // 'platform' | 'tenant' | 'own-domain'

  // BYOKé…ç½®é¢„ç•™ï¼ˆæœªæ¥æ”¯æŒä»£ç†è‡ªå·±çš„æ”¯ä»˜é…ç½®ï¼‰
  byokConfig         String?  // JSONæ ¼å¼ï¼š{stripeAccountId?, paymentMethods?, etc.}

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  agent              Agent    @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("agent_mall_configs")
}

// ä»£ç†åŸŸåé…ç½®
model AgentDomain {
  id            String   @id @default(cuid())
  agentId       String
  tenantId      Int
  host          String   // å®Œæ•´åŸŸåï¼ˆå¦‚ agent-own-domain.comï¼‰
  isPrimary     Boolean  @default(false)

  // SSL/éªŒè¯çŠ¶æ€
  sslConfigured Boolean  @default(false)
  dnsVerified   Boolean  @default(false)
  verifiedAt    DateTime?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  agent         Agent    @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([host])  // åŸŸåå…¨å±€å”¯ä¸€
  @@index([agentId])
  @@index([tenantId])
  @@map("agent_domains")
}

// ä»£ç†ç­‰çº§é…ç½®ï¼ˆæ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹é…ç½®ä¸‰çº§ä»£ç†çš„è´¹ç‡ï¼‰
model AgentLevelConfig {
  id                  String   @id @default(cuid())
  tenantId            Int
  level               Int      // 1, 2, 3

  // ä½£é‡‘è´¹ç‡
  commissionRate      Float    // è¯¥ç­‰çº§ä»£ç†çš„ä½£é‡‘æ¯”ä¾‹ï¼ˆ%ï¼‰

  // é™åˆ¶é…ç½®
  maxAgentsPerParent  Int      @default(100)  // æ¯ä¸ªä¸Šçº§ä»£ç†æœ€å¤šå‘å±•çš„ä¸‹çº§æ•°é‡
  maxProducts         Int?     // è¯¥ç­‰çº§ä»£ç†æœ€å¤šå¯é”€å”®çš„å•†å“æ•°ï¼ˆnull=ä¸é™ï¼‰

  // åˆ†æ¶¦é…ç½®ï¼ˆä¸‰çº§åˆ†æ¶¦æ—¶å„çº§çš„æ¯”ä¾‹ï¼‰
  l1ShareRate         Float?   // L1ä»è¯¥ç­‰çº§è®¢å•è·å¾—çš„åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰
  l2ShareRate         Float?   // L2ä»è¯¥ç­‰çº§è®¢å•è·å¾—çš„åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰
  l3ShareRate         Float?   // L3ä»è¯¥ç­‰çº§è®¢å•è·å¾—çš„åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, level])
  @@index([tenantId])
  @@map("agent_level_configs")
}

// ä»£ç†ä½£é‡‘è®°å½•ï¼ˆä¸‰çº§åˆ†æ¶¦ï¼‰
model AgentCommission {
  id          String   @id @default(cuid())
  tenantId    Int
  agentId     String   // è·å¾—ä½£é‡‘çš„ä»£ç†
  orderId     String   // å…³è”è®¢å•
  buyerId     String   // è´­ä¹°ç”¨æˆ·

  // ä»£ç†é“¾è·¯ä¿¡æ¯
  agentLevel  Int      // è¯¥ä»£ç†çš„ç­‰çº§ï¼ˆ1/2/3ï¼‰
  sourceAgentId String? // è®¢å•æ¥æºä»£ç†IDï¼ˆå¯èƒ½æ˜¯è‡ªå·±æˆ–ä¸‹çº§ï¼‰

  orderAmount Float    // è®¢å•é‡‘é¢
  rate        Float    // ä½¿ç”¨çš„åˆ†æ¶¦æ¯”ä¾‹ï¼ˆ%ï¼‰
  amount      Float    // ä½£é‡‘é‡‘é¢

  status      String   @default("PENDING") // PENDING(å¾…ç»“ç®—), SETTLED(å·²ç»“ç®—å¯æç°), PAID(å·²æ”¯ä»˜), REFUNDED(å·²é€€æ¬¾)

  // æ—¶é—´ä¿¡æ¯
  settleAt    DateTime   // ç»“ç®—æ—¶é—´ï¼ˆæ”¯ä»˜æˆåŠŸåNå¤©ï¼‰
  settledAt   DateTime?  // å®é™…ç»“ç®—æ—¶é—´
  paidAt      DateTime?  // æ”¯ä»˜æ—¶é—´
  refundedAt  DateTime?  // é€€æ¬¾æ—¶é—´

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  agent       Agent    @relation(fields: [agentId], references: [id])
  order       Order    @relation(fields: [orderId], references: [id])

  @@index([tenantId])
  @@index([agentId])
  @@index([orderId])
  @@index([status])
  @@index([settleAt])
  @@map("agent_commissions")
}

// ============================================
// ğŸ†• ä»£ç†å˜ä½“æˆæƒé…ç½®æ¨¡å‹ (Self & Children è·¯å¾„)
// ============================================

// Selfè·¯å¾„é…ç½® - æ§åˆ¶"è‡ªå·±å•†åŸ"çš„å˜ä½“å¯å”®æ€§å’Œä»·æ ¼
// é€‚ç”¨äºç§Ÿæˆ·(ownerType='TENANT')å’Œä»£ç†(ownerType='AGENT')
//
// ğŸ”‘ ownerId è¯­ä¹‰è¯´æ˜ï¼š
// - ownerType='TENANT' æ—¶ï¼ŒownerId å­˜å‚¨ tenantId çš„å­—ç¬¦ä¸²å½¢å¼
// - ownerType='AGENT' æ—¶ï¼ŒownerId å­˜å‚¨ agent.id
// æ³¨æ„ï¼šä¸ä½¿ç”¨å¤–é”®å…³è” Agent è¡¨ï¼Œå› ä¸º ownerId æœ‰ä¸¤ç§è¯­ä¹‰
model AgentVariantSelfConfig {
  id          String   @id @default(cuid())
  tenantId    Int
  ownerType   String   // 'TENANT' | 'AGENT' - é…ç½®æ‰€æœ‰è€…ç±»å‹
  ownerId     String   // ç§Ÿæˆ·æ—¶ä¸ºtenantIdå­—ç¬¦ä¸²ï¼Œä»£ç†æ—¶ä¸ºagent.idï¼ˆé€»è¾‘å­—æ®µï¼Œä¸åšå¤–é”®ï¼‰
  productId   String   // å•†å“IDï¼ˆç”¨äºå¿«é€ŸæŸ¥è¯¢ï¼‰
  variantId   String   // å˜ä½“ID

  // Selfè·¯å¾„æ ¸å¿ƒå­—æ®µ
  canSellSelf Boolean  @default(true) // æ˜¯å¦åœ¨è‡ªå·±å•†åŸé”€å”®è¯¥å˜ä½“
  selfPrice   Float?   // è‡ªå®šä¹‰é”€å”®ä»·æ ¼ï¼ˆnullè¡¨ç¤ºç»§æ‰¿ä¸Šçº§ä»·æ ¼ï¼‰

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations - åªä¿ç•™æ˜ç¡®çš„å¤–é”®å…³ç³»ï¼ŒownerId ä½œä¸ºé€»è¾‘å­—æ®µä¸åšå¤–é”®
  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  product     Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant     ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  // ç§»é™¤ï¼šagent Agent? @relation(...) - ownerId æœ‰ä¸¤ç§è¯­ä¹‰ï¼Œä¸é€‚åˆåšå¤–é”®

  @@unique([tenantId, ownerType, ownerId, variantId]) // æ¯ä¸ªæ‰€æœ‰è€…å¯¹æ¯ä¸ªå˜ä½“åªæœ‰ä¸€æ¡é…ç½®
  @@index([tenantId])
  @@index([ownerType, ownerId])
  @@index([productId])
  @@index([variantId])
  @@map("agent_variant_self_configs")
}

// Childrenè·¯å¾„é…ç½® - æ§åˆ¶"ç»™ä¸‹çº§ä»£ç†"çš„å˜ä½“æˆæƒå’Œä»·æ ¼
// é€‚ç”¨äºç§Ÿæˆ·(ownerType='TENANT')å’Œä»£ç†(ownerType='AGENT')
//
// ğŸ”‘ ownerId è¯­ä¹‰è¯´æ˜ï¼š
// - ownerType='TENANT' æ—¶ï¼ŒownerId å­˜å‚¨ tenantId çš„å­—ç¬¦ä¸²å½¢å¼
// - ownerType='AGENT' æ—¶ï¼ŒownerId å­˜å‚¨ agent.id
// æ³¨æ„ï¼šä¸ä½¿ç”¨å¤–é”®å…³è” Agent è¡¨ï¼Œå› ä¸º ownerId æœ‰ä¸¤ç§è¯­ä¹‰
model AgentVariantChildrenConfig {
  id          String   @id @default(cuid())
  tenantId    Int
  ownerType   String   // 'TENANT' | 'AGENT' - é…ç½®æ‰€æœ‰è€…ç±»å‹
  ownerId     String   // ç§Ÿæˆ·æ—¶ä¸ºtenantIdå­—ç¬¦ä¸²ï¼Œä»£ç†æ—¶ä¸ºagent.idï¼ˆé€»è¾‘å­—æ®µï¼Œä¸åšå¤–é”®ï¼‰
  productId   String   // å•†å“IDï¼ˆç”¨äºå•†å“çº§æ§åˆ¶ï¼‰
  variantId   String?  // å˜ä½“IDï¼ˆä¸ºnullæ—¶è¡¨ç¤ºå•†å“çº§é…ç½®ï¼‰

  // Childrenè·¯å¾„æ ¸å¿ƒå­—æ®µ - å•†å“çº§
  canDelegateProduct Boolean @default(true) // æ˜¯å¦å…è®¸è¯¥å•†å“æˆæƒç»™ä¸‹çº§ï¼ˆå•†å“çº§æŒ‰é’®ï¼‰

  // Childrenè·¯å¾„æ ¸å¿ƒå­—æ®µ - å˜ä½“çº§
  canDelegateVariant Boolean @default(true) // æ˜¯å¦å…è®¸è¯¥å˜ä½“æˆæƒç»™ä¸‹çº§ï¼ˆå˜ä½“çº§æŒ‰é’®ï¼‰
  priceForChildren   Float?  // ç»™ä¸‹çº§çš„æˆæœ¬ä»·/èµ·å§‹ä»·
  priceForChildrenMin Float? // ç»™ä¸‹çº§çš„æœ€ä½å”®ä»·é™åˆ¶
  priceForChildrenMax Float? // ç»™ä¸‹çº§çš„æœ€é«˜å”®ä»·é™åˆ¶

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations - åªä¿ç•™æ˜ç¡®çš„å¤–é”®å…³ç³»ï¼ŒownerId ä½œä¸ºé€»è¾‘å­—æ®µä¸åšå¤–é”®
  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  product     Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant     ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)
  // ç§»é™¤ï¼šagent Agent? @relation(...) - ownerId æœ‰ä¸¤ç§è¯­ä¹‰ï¼Œä¸é€‚åˆåšå¤–é”®

  @@unique([tenantId, ownerType, ownerId, productId, variantId]) // å”¯ä¸€çº¦æŸ
  @@index([tenantId])
  @@index([ownerType, ownerId])
  @@index([productId])
  @@index([variantId])
  @@map("agent_variant_children_configs")
}
